# ScrapedKnees Chrome Extension - Makefile
# Provides simple commands for common development tasks

.PHONY: help install build dev test test-watch lint lint-fix clean package deploy check-deps

# Default target
help:
	@echo "ScrapedKnees Chrome Extension - Available Commands:"
	@echo ""
	@echo "Setup:"
	@echo "  install     - Install dependencies"
	@echo "  check-deps  - Check if dependencies are installed"
	@echo ""
	@echo "Development:"
	@echo "  dev         - Start development mode with watch"
	@echo "  build       - Build for production"
	@echo "  clean       - Clean build artifacts"
	@echo ""
	@echo "Testing:"
	@echo "  test        - Run unit tests"
	@echo "  test-watch  - Run tests in watch mode"
	@echo ""
	@echo "Code Quality:"
	@echo "  lint        - Check code quality"
	@echo "  lint-fix    - Fix linting issues"
	@echo ""
	@echo "Deployment:"
	@echo "  package     - Create extension.zip for distribution"
	@echo "  deploy      - Full deployment pipeline (build, test, package)"
	@echo ""
	@echo "Chrome Extension:"
	@echo "  load-chrome - Instructions for loading extension in Chrome"
	@echo "  reload-chrome - Instructions for reloading extension"
	@echo ""

# Setup commands
install:
	@echo "Installing dependencies..."
	npm install
	@echo "âœ… Dependencies installed successfully"

check-deps:
	@echo "Checking dependencies..."
	@if [ ! -d "node_modules" ]; then \
		echo "âŒ Dependencies not found. Run 'make install' first."; \
		exit 1; \
	fi
	@echo "âœ… Dependencies found"

# Development commands
dev: check-deps
	@echo "Starting development mode..."
	@echo "ğŸ“ Watching for changes..."
	@echo "ğŸ”„ Auto-rebuilding on file changes..."
	@echo "â¹ï¸  Press Ctrl+C to stop"
	npm run dev

build: check-deps
	@echo "Building for production..."
	npm run build
	@echo "âœ… Build completed successfully"
	@echo "ğŸ“ Extension files created in dist/"

clean:
	@echo "Cleaning build artifacts..."
	rm -rf dist/
	rm -f extension.zip
	@echo "âœ… Clean completed"

# Testing commands
test: check-deps
	@echo "Running unit tests..."
	npm test
	@echo "âœ… Tests completed"

build-icon: check-deps
	@echo "Building extension icons..."
	@if [ ! -f icon.png ]; then \
		echo "âŒ icon.png not found. Please add your custom 128x128 PNG icon to the root directory."; \
		echo "   Then run: make build-icon"; \
		exit 1; \
	fi
	@echo "Converting icon.png to multiple sizes..."
	@mkdir -p src/icons
	@cp icon.png src/icons/icon128.png
	@echo "âœ… Icons built successfully"
	@echo "ğŸ“ Icon files created in src/icons/"

test-watch: check-deps
	@echo "Running tests in watch mode..."
	@echo "ğŸ”„ Tests will re-run on file changes"
	@echo "â¹ï¸  Press Ctrl+C to stop"
	npm run test:watch

# Code quality commands
lint: check-deps
	@echo "Checking code quality..."
	npm run lint
	@echo "âœ… Linting completed"

lint-fix: check-deps
	@echo "Fixing linting issues..."
	npm run lint:fix
	@echo "âœ… Linting issues fixed"

# Deployment commands
package: build
	@echo "Creating extension package..."
	npm run package
	@echo "âœ… Extension packaged as extension.zip"
	@echo "ğŸ“¦ Ready for distribution"

deploy: clean lint test build package
	@echo "ğŸ‰ Deployment pipeline completed successfully!"
	@echo "ğŸ“¦ Extension ready: extension.zip"
	@echo "ğŸ“ Build files: dist/"

# Chrome extension specific commands
load-chrome:
	@echo "ğŸ“‹ Instructions to load extension in Chrome:"
	@echo "1. Open Chrome and go to chrome://extensions/"
	@echo "2. Enable 'Developer mode' (toggle in top right)"
	@echo "3. Click 'Load unpacked'"
	@echo "4. Select the 'dist' folder from this project"
	@echo ""
	@echo "ğŸ’¡ Make sure to run 'make build' first!"

reload-chrome:
	@echo "ğŸ“‹ Instructions to reload extension:"
	@echo "1. Go to chrome://extensions/"
	@echo "2. Find 'AI Data Scraper' extension"
	@echo "3. Click the refresh icon ğŸ”„"
	@echo "4. Or press Ctrl+R on the extension page"
	@echo ""
	@echo "ğŸ’¡ Run 'make build' first if you made changes!"

# Quick development workflow
quick-dev: install dev

quick-test: install test

quick-build: install build

# Development workflow with all checks
dev-full: install lint test build
	@echo "ğŸ¯ Development environment ready!"
	@echo "ğŸ“ Extension built in dist/"
	@echo "ğŸ§ª Tests passed"
	@echo "âœ¨ Code quality checks passed"

# Production readiness check
prod-check: install lint test build package
	@echo "ğŸš€ Production readiness check completed!"
	@echo "âœ… All checks passed"
	@echo "ğŸ“¦ Extension packaged: extension.zip"
	@echo "ğŸ“ Build files: dist/"

# Show project status
status:
	@echo "ğŸ“Š ScrapedKnees Status:"
	@echo ""
	@if [ -d "node_modules" ]; then \
		echo "âœ… Dependencies: Installed"; \
	else \
		echo "âŒ Dependencies: Not installed (run 'make install')"; \
	fi
	@if [ -d "dist" ]; then \
		echo "âœ… Build: Available (dist/)"; \
	else \
		echo "âŒ Build: Not available (run 'make build')"; \
	fi
	@if [ -f "extension.zip" ]; then \
		echo "âœ… Package: Available (extension.zip)"; \
	else \
		echo "âŒ Package: Not available (run 'make package')"; \
	fi
	@echo ""
	@echo "ğŸ“‹ Next steps:"
	@if [ ! -d "node_modules" ]; then \
		echo "  make install"; \
	fi
	@if [ ! -d "dist" ]; then \
		echo "  make build"; \
	fi
	@if [ ! -f "extension.zip" ]; then \
		echo "  make package"; \
	fi
	@echo "  make load-chrome"