{"version":3,"file":"popup.js","mappings":"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","sources":["webpack://ai-data-scraper-extension/./src/popup.js"],"sourcesContent":["// Popup script for AI Data Scraper extension\n\nclass PopupController {\n  constructor() {\n    this.currentTab = null;\n    this.isTrainingActive = false;\n    this.initialize();\n  }\n\n  async initialize() {\n    // Get current active tab\n    const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });\n    this.currentTab = tab;\n\n    // Bind event listeners\n    this.bindEventListeners();\n\n    // Load initial data\n    await this.loadTrainingSessions();\n    await this.checkTrainingStatus();\n\n    console.log('Popup initialized for tab:', this.currentTab?.url);\n  }\n\n  bindEventListeners() {\n    // Training controls\n    document.getElementById('start-training').addEventListener('click', () => {\n      this.startTraining();\n    });\n\n    document.getElementById('stop-training').addEventListener('click', () => {\n      this.stopTraining();\n    });\n\n    // Data extraction controls\n    document.getElementById('extract-data').addEventListener('click', () => {\n      this.extractData();\n    });\n\n    document.getElementById('export-data').addEventListener('click', () => {\n      this.exportData();\n    });\n\n    // Session list clicks\n    document.getElementById('sessions-list').addEventListener('click', (event) => {\n      const sessionItem = event.target.closest('.session-item');\n      if (sessionItem) {\n        const sessionId = sessionItem.dataset.sessionId;\n        this.loadSession(sessionId);\n      }\n    });\n  }\n\n  async startTraining() {\n    try {\n      if (!this.currentTab) {\n        throw new Error('No active tab found');\n      }\n\n      // Check if we're on a valid page\n      if (!this.currentTab.url || this.currentTab.url.startsWith('chrome://')) {\n        throw new Error('Cannot train on this page. Please navigate to a regular website.');\n      }\n\n      // Send message to start training\n      await chrome.runtime.sendMessage({\n        type: 'START_TRAINING',\n        data: {\n          url: this.currentTab.url,\n          timestamp: new Date().toISOString()\n        }\n      });\n\n      this.isTrainingActive = true;\n      this.updateTrainingUI();\n      this.showStatus('Training mode started! Use Ctrl+Shift+S to toggle on the page.', 'success');\n\n    } catch (error) {\n      console.error('Error starting training:', error);\n      this.showStatus(`Error: ${error.message}`, 'error');\n    }\n  }\n\n  async stopTraining() {\n    try {\n      if (!this.currentTab) {\n        throw new Error('No active tab found');\n      }\n\n      // Send message to stop training\n      await chrome.runtime.sendMessage({\n        type: 'STOP_TRAINING'\n      });\n\n      this.isTrainingActive = false;\n      this.updateTrainingUI();\n      this.showStatus('Training mode stopped.', 'info');\n\n      // Reload sessions to show new data\n      await this.loadTrainingSessions();\n\n    } catch (error) {\n      console.error('Error stopping training:', error);\n      this.showStatus(`Error: ${error.message}`, 'error');\n    }\n  }\n\n  async extractData() {\n    try {\n      if (!this.currentTab) {\n        throw new Error('No active tab found');\n      }\n\n      // Get training sessions for this URL\n      const sessions = await this.getTrainingSessions();\n      const relevantSessions = sessions.filter(session => \n        session.url === this.currentTab.url\n      );\n\n      if (relevantSessions.length === 0) {\n        throw new Error('No training data found for this page. Please train the scraper first.');\n      }\n\n      // Use the most recent session\n      const latestSession = relevantSessions[relevantSessions.length - 1];\n\n      // Send message to execute scraping\n      await chrome.runtime.sendMessage({\n        type: 'EXECUTE_SCRAPING',\n        data: {\n          sessionId: latestSession.id,\n          config: latestSession.config\n        }\n      });\n\n      this.showStatus('Data extraction started!', 'success');\n\n    } catch (error) {\n      console.error('Error extracting data:', error);\n      this.showStatus(`Error: ${error.message}`, 'error');\n    }\n  }\n\n  async exportData() {\n    try {\n      const scrapedData = await this.getScrapedData();\n      \n      if (scrapedData.length === 0) {\n        throw new Error('No data to export. Please extract data first.');\n      }\n\n      // Create CSV content\n      const csvContent = this.convertToCSV(scrapedData);\n      \n      // Create and download file\n      const blob = new Blob([csvContent], { type: 'text/csv' });\n      const url = URL.createObjectURL(blob);\n      \n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `scraped-data-${new Date().toISOString().split('T')[0]}.csv`;\n      a.click();\n      \n      URL.revokeObjectURL(url);\n      this.showStatus('Data exported successfully!', 'success');\n\n    } catch (error) {\n      console.error('Error exporting data:', error);\n      this.showStatus(`Error: ${error.message}`, 'error');\n    }\n  }\n\n  convertToCSV(data) {\n    if (data.length === 0) return '';\n\n    // Get all unique keys from all objects\n    const keys = [...new Set(data.flatMap(obj => Object.keys(obj)))];\n    \n    // Create header row\n    const header = keys.join(',');\n    \n    // Create data rows\n    const rows = data.map(obj => \n      keys.map(key => {\n        const value = obj[key] || '';\n        // Escape commas and quotes\n        return `\"${String(value).replace(/\"/g, '\"\"')}\"`;\n      }).join(',')\n    );\n    \n    return [header, ...rows].join('\\n');\n  }\n\n  async loadTrainingSessions() {\n    try {\n      this.showLoading(true);\n      \n      const sessions = await this.getTrainingSessions();\n      this.renderTrainingSessions(sessions);\n      \n    } catch (error) {\n      console.error('Error loading training sessions:', error);\n      this.showStatus('Error loading training sessions', 'error');\n    } finally {\n      this.showLoading(false);\n    }\n  }\n\n  async getTrainingSessions() {\n    return new Promise((resolve, reject) => {\n      chrome.runtime.sendMessage({ type: 'GET_TRAINING_SESSIONS' }, (response) => {\n        if (response && response.success) {\n          resolve(response.data);\n        } else {\n          reject(new Error(response?.error || 'Failed to get training sessions'));\n        }\n      });\n    });\n  }\n\n  async getScrapedData() {\n    return new Promise((resolve, reject) => {\n      chrome.runtime.sendMessage({ type: 'GET_SCRAPED_DATA' }, (response) => {\n        if (response && response.success) {\n          resolve(response.data);\n        } else {\n          reject(new Error(response?.error || 'Failed to get scraped data'));\n        }\n      });\n    });\n  }\n\n  renderTrainingSessions(sessions) {\n    const sessionsList = document.getElementById('sessions-list');\n    const emptySessions = document.getElementById('empty-sessions');\n\n    if (sessions.length === 0) {\n      sessionsList.style.display = 'none';\n      emptySessions.style.display = 'block';\n      return;\n    }\n\n    sessionsList.style.display = 'block';\n    emptySessions.style.display = 'none';\n\n    // Sort sessions by date (newest first)\n    const sortedSessions = sessions.sort((a, b) => \n      new Date(b.createdAt) - new Date(a.createdAt)\n    );\n\n    sessionsList.innerHTML = sortedSessions.map(session => `\n      <div class=\"session-item\" data-session-id=\"${session.id}\">\n        <div class=\"session-title\">${this.getDomainFromUrl(session.url)}</div>\n        <div class=\"session-meta\">\n          ${session.selectedElements?.length || 0} elements selected â€¢ \n          ${new Date(session.createdAt).toLocaleDateString()}\n        </div>\n      </div>\n    `).join('');\n  }\n\n  getDomainFromUrl(url) {\n    try {\n      const domain = new URL(url).hostname;\n      return domain.replace('www.', '');\n    } catch {\n      return 'Unknown site';\n    }\n  }\n\n  async checkTrainingStatus() {\n    // This would check if training is currently active on the current tab\n    // For now, we'll just check if we're on a valid page\n    const isValidPage = this.currentTab && \n                       this.currentTab.url && \n                       !this.currentTab.url.startsWith('chrome://');\n\n    const startButton = document.getElementById('start-training');\n    const stopButton = document.getElementById('stop-training');\n\n    if (isValidPage) {\n      startButton.disabled = false;\n      stopButton.disabled = !this.isTrainingActive;\n    } else {\n      startButton.disabled = true;\n      stopButton.disabled = true;\n    }\n  }\n\n  updateTrainingUI() {\n    const startButton = document.getElementById('start-training');\n    const stopButton = document.getElementById('stop-training');\n    const statusDiv = document.getElementById('training-status');\n\n    if (this.isTrainingActive) {\n      startButton.disabled = true;\n      stopButton.disabled = false;\n      statusDiv.style.display = 'block';\n      statusDiv.className = 'status success';\n      statusDiv.textContent = 'Training mode is active!';\n    } else {\n      startButton.disabled = false;\n      stopButton.disabled = true;\n      statusDiv.style.display = 'none';\n    }\n  }\n\n  showStatus(message, type = 'info') {\n    const statusDiv = document.getElementById('training-status');\n    statusDiv.textContent = message;\n    statusDiv.className = `status ${type}`;\n    statusDiv.style.display = 'block';\n\n    // Auto-hide after 5 seconds\n    setTimeout(() => {\n      if (statusDiv.textContent === message) {\n        statusDiv.style.display = 'none';\n      }\n    }, 5000);\n  }\n\n  showLoading(show) {\n    const loading = document.querySelector('.loading');\n    const sessionsList = document.getElementById('sessions-list');\n    const emptySessions = document.getElementById('empty-sessions');\n\n    if (show) {\n      loading.style.display = 'block';\n      sessionsList.style.display = 'none';\n      emptySessions.style.display = 'none';\n    } else {\n      loading.style.display = 'none';\n    }\n  }\n\n  async loadSession(sessionId) {\n    try {\n      const sessions = await this.getTrainingSessions();\n      const session = sessions.find(s => s.id === sessionId);\n      \n      if (session) {\n        // Navigate to the session URL if it's different from current tab\n        if (session.url !== this.currentTab.url) {\n          await chrome.tabs.update(this.currentTab.id, { url: session.url });\n        }\n        \n        this.showStatus(`Loaded training session for ${this.getDomainFromUrl(session.url)}`, 'success');\n      }\n    } catch (error) {\n      console.error('Error loading session:', error);\n      this.showStatus('Error loading session', 'error');\n    }\n  }\n}\n\n// Initialize popup when DOM is loaded\ndocument.addEventListener('DOMContentLoaded', () => {\n  new PopupController();\n});"],"names":[],"sourceRoot":""}